name: Release

on:
  push:
    tags:
      - 'v*.*.*'
  workflow_dispatch:

jobs:
  create-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          generate_release_notes: true
          body: |
            ## CARLA Docker Release

            ### Supported Platforms
            - `linux/amd64` - x86_64 Desktop/Server ✅
            - `linux/arm64` - Jetson Orin Python Client ✅

            ### Installation

            **x86_64 (Full CARLA Simulator):**
            ```bash
            git clone https://github.com/tri2510/carla-multiarch-docker.git
            cd carla-multiarch-docker
            cp .env.example .env
            docker compose up -d
            ```

            **Jetson Orin (Python Client):**
            ```bash
            git clone https://github.com/tri2510/carla-multiarch-docker.git
            cd carla-multiarch-docker
            docker build -f Dockerfile.jetson-client -t carla-jetson-client .
            docker compose -f docker-compose.jetson-client.yml up -d
            ```

            ### Documentation
            - [README.md](README.md) - Main documentation
            - [docs/QUICKSTART.md](docs/QUICKSTART.md) - Quick start guide
            - [docs/JETSON_CLIENT.md](docs/JETSON_CLIENT.md) - Jetson setup
            - [docs/RESEARCH_ARM64.md](docs/RESEARCH_ARM64.md) - ARM64 research

            ### Note on Docker Images
            Pre-built Docker images are not provided due to CARLA's large size (~10GB).
            Build locally using the provided Dockerfiles.

            **Build commands:**
            ```bash
            # x86_64
            ./build.sh --platform linux/amd64

            # Jetson client
            docker build -f Dockerfile.jetson-client -t carla-jetson-client .
            ```

            See [README.md](README.md) for full documentation.
